<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Dynamic Connector</title>
    <style>
        * {
            box-sizing: border-box;
        }

        body {
            margin: 0;
            height: 100vh;
            display: flex;
            font-family: sans-serif;
            overflow: hidden;
        }

        #workspace {
            flex: 1;
            display: flex;
            position: relative;
        }

        #left-column,
        #right-column {
            width: 150px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            gap: 12px;
            padding: 10px;
            position: relative;
            z-index: 1;
        }

        .box {
            width: 100px;
            height: 50px;
            background: #f1c40f;
            border: 2px solid #e67e22;
            border-radius: 8px;
            text-align: center;
            line-height: 50px;
            font-weight: bold;
            user-select: none;
            cursor: pointer;
            position: relative;
        }

        #connector-svg {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 0;
        }

        .line {
            stroke: black;
            stroke-width: 2;
            cursor: pointer;
            pointer-events: auto;
        }

        #connection-model {
            width: 240px;
            background: #f9f9f9;
            border-left: 1px solid #ccc;
            padding: 10px;
            font-size: 14px;
            overflow-y: auto;
        }

        #connection-model h3 {
            margin-top: 0;
            font-size: 16px;
        }

        .conn-entry {
            margin: 4px 0;
            font-family: monospace;
        }

        button {
            margin-top: 10px;
            padding: 6px 10px;
        }
    </style>
</head>

<body>

    <div id="workspace">
        <div id="left-column"></div>
        <svg id="connector-svg"></svg>
        <div id="right-column"></div>
    </div>

    <div id="connection-model">
        <h3>Connections</h3>
        <div id="conn-list"></div>
        <button onclick="gradeConnections()">Grade</button>
    </div>

    <script>
        const leftColumn = document.getElementById('left-column');
        const rightColumn = document.getElementById('right-column');
        const svg = document.getElementById('connector-svg');
        const connList = document.getElementById('conn-list');
        const connections = [];

        // üß† Define correct answers
        const correctAnswers = [
            ["A", "E"],
            ["A", "F"],
            ["B", "D"]
        ];

        // üöÄ Dynamically generate boxes
        const leftNames = ["A", "B", "C"]; // add up to 10
        const rightNames = ["D", "E", "F", "G"]; // add up to 10

        function createBox(name, role) {
            const div = document.createElement('div');
            div.className = 'box';
            div.dataset.name = name;
            div.dataset.role = role;
            div.textContent = name;
            return div;
        }

        const allBoxes = [];

        leftNames.forEach(name => {
            const box = createBox(name, "drag");
            leftColumn.appendChild(box);
            allBoxes.push(box);
        });

        rightNames.forEach(name => {
            const box = createBox(name, "drop");
            rightColumn.appendChild(box);
            allBoxes.push(box);
        });

        // üîó Connection logic
        let startBox = null;
        let tempLine = null;

        function getCenter(el) {
            const rect = el.getBoundingClientRect();
            return {
                x: rect.left + rect.width / 2,
                y: rect.top + rect.height / 2
            };
        }

        function createLineElement(x1, y1, x2, y2) {
            const line = document.createElementNS("http://www.w3.org/2000/svg", "line");
            line.setAttribute("x1", x1);
            line.setAttribute("y1", y1);
            line.setAttribute("x2", x2);
            line.setAttribute("y2", y2);
            line.setAttribute("class", "line");

            line.addEventListener("click", () => {
                svg.removeChild(line);
                const index = connections.findIndex(conn =>
                    (conn.fromBox === line.fromBox && conn.toBox === line.toBox) ||
                    (conn.fromBox === line.toBox && conn.toBox === line.fromBox)
                );
                if (index !== -1) connections.splice(index, 1);
                updateConnectionModel();
            });

            return line;
        }

        function createPermanentLine(fromBox, toBox) {
            const fromRole = fromBox.dataset.role;
            const toRole = toBox.dataset.role;

            if (fromRole === toRole) {
                alert("You can only connect a draggable to a droppable.");
                return;
            }

            if (isConnected(fromBox, toBox)) return;

            const from = getCenter(fromBox);
            const to = getCenter(toBox);
            const line = createLineElement(from.x, from.y, to.x, to.y);
            line.fromBox = fromBox;
            line.toBox = toBox;

            svg.appendChild(line);
            connections.push({ fromBox, toBox, line });
            updateConnectionModel();
        }

        function isConnected(a, b) {
            return connections.some(conn =>
                (conn.fromBox === a && conn.toBox === b) ||
                (conn.fromBox === b && conn.toBox === a)
            );
        }

        function updateTempLine(e) {
            if (!startBox || !tempLine) return;
            const from = getCenter(startBox);
            tempLine.setAttribute("x1", from.x);
            tempLine.setAttribute("y1", from.y);
            tempLine.setAttribute("x2", e.clientX);
            tempLine.setAttribute("y2", e.clientY);
        }

        function finishConnection(e) {
            if (tempLine) {
                svg.removeChild(tempLine);
                tempLine = null;
            }

            const endBox = allBoxes.find(box =>
                box.contains(e.target) && box !== startBox
            );

            if (startBox && endBox) {
                createPermanentLine(startBox, endBox);
            }

            startBox = null;
            document.removeEventListener("mousemove", updateTempLine);
            document.removeEventListener("mouseup", finishConnection);
        }

        allBoxes.forEach(box => {
            box.addEventListener("mousedown", e => {
                if (e.ctrlKey || e.metaKey) {
                    e.preventDefault();
                    startBox = box;
                    const from = getCenter(startBox);
                    tempLine = createLineElement(from.x, from.y, from.x, from.y);
                    tempLine.setAttribute("stroke", "gray");
                    tempLine.setAttribute("stroke-dasharray", "4");
                    svg.appendChild(tempLine);

                    document.addEventListener("mousemove", updateTempLine);
                    document.addEventListener("mouseup", finishConnection);
                }
            });
        });

        function updateConnectionModel() {
            connList.innerHTML = "<strong>Connections:</strong><br>";
            connections.forEach(conn => {
                const fromName = conn.fromBox.dataset.name;
                const toName = conn.toBox.dataset.name;
                const line = document.createElement('div');
                line.className = 'conn-entry';
                line.textContent = `${fromName} ‚Üí ${toName}`;
                connList.appendChild(line);
            });
        }

        function gradeConnections() {
            const actual = connections.map(conn => {
                const from = conn.fromBox.dataset.name;
                const to = conn.toBox.dataset.name;
                return [from, to];
            });

            const results = [];

            correctAnswers.forEach(expected => {
                const found = actual.some(actualConn =>
                    actualConn[0] === expected[0] && actualConn[1] === expected[1]
                );
                results.push({ expected, correct: found });
            });

            const extraConnections = actual.filter(actualConn =>
                !correctAnswers.some(expected =>
                    expected[0] === actualConn[0] && expected[1] === actualConn[1]
                )
            );

            connList.innerHTML = "<strong>Grading:</strong><br>";
            let correctCount = 0;

            results.forEach(r => {
                const line = document.createElement('div');
                line.className = 'conn-entry';
                line.textContent = `${r.expected[0]} ‚Üí ${r.expected[1]} ${r.correct ? "‚úÖ" : "‚ùå"}`;
                connList.appendChild(line);
                if (r.correct) correctCount++;
            });

            if (extraConnections.length > 0) {
                const extraHeader = document.createElement('div');
                extraHeader.innerHTML = `<br><strong>Extra/Incorrect:</strong>`;
                connList.appendChild(extraHeader);

                extraConnections.forEach(extra => {
                    const line = document.createElement('div');
                    line.className = 'conn-entry';
                    line.textContent = `${extra[0]} ‚Üí ${extra[1]} ‚ùå`;
                    connList.appendChild(line);
                });
            }

            const scorePercent = Math.round((correctCount / correctAnswers.length) * 100);
            const scoreLine = document.createElement('div');
            scoreLine.innerHTML = `<br><strong>Score: ${scorePercent}%</strong>`;
            connList.appendChild(scoreLine);
        }

        window.addEventListener("resize", () => {
            connections.forEach(conn => {
                const from = getCenter(conn.fromBox);
                const to = getCenter(conn.toBox);
                conn.line.setAttribute("x1", from.x);
                conn.line.setAttribute("y1", from.y);
                conn.line.setAttribute("x2", to.x);
                conn.line.setAttribute("y2", to.y);
            });
        });
    </script>

</body>

</html>